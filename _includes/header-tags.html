{% assign theme = 'fakeco1' %}
{% assign theme = 'unfairadv' %}
{% assign theme = 'ohs' %}
<link rel="stylesheet" href="{{ site.baseurl }}/assets/css/style.css" />

<script defer src="https://unpkg.com/@alpinejs/persist@3.x.x/dist/cdn.min.js"></script>
<script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>

<!-- OHS FONTS ---------------------------------------------- -->
<link rel="stylesheet" href="https://use.typekit.net/ato5yse.css">
<!-- end OHS FONTS ------------------------------------------ -->
<!-- FAKE FONTS --------------------------------------------- -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,500;1,900&display=swap" rel="stylesheet">
<!-- end FAKE FONTS ------------------------------------------ -->
<!-- UNFAIR ADVANTAGE FONTS ------------------------------------------ -->
<style id="custom-css">
@font-face {
  font-family: 'PlusBold';
  src: url('https://tfl-fonts.s3.us-east-2.amazonaws.com/jakarta/PlusJakartaDisplay-Bold.otf');
}
@font-face {
  font-family: 'PlusRegular';
  src: url('https://tfl-fonts.s3.us-east-2.amazonaws.com/jakarta/PlusJakartaText-Light.otf');
}
</style>
<!-- end UNFAIR ADVANTAGE FONTS -------------------------------------- -->

<script type="text/javascript">
function theme() {
    return {
        colorThemes: [
            'theme-ohs',
            'theme-fakeco',
            'theme-unfairadv'
        ],
        themeClass: {},
        choiceClass(className) {
            const classes = {'color-choice': true};
            classes[className] = true;
            return classes;
        },
        changeTheme(className) {
            this.themeClass = this.colorThemes.reduce((allClasses, cn) => {
                allClasses[cn] = className === cn;
                localStorage.setItem('theme-class',className);
                return allClasses;
            }, {});
        },
        getTheme() {
          var initClass = localStorage.getItem('theme-class');
          if (!initClass) {
            initClass = 'theme-ohs';
          }
          return this.themeClass = initClass;
        }
    }
}
</script>

{% if page.nav == 'location-lookup' %}
<script type="text/javascript">console.log('322hi');</script>

<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
<script src="https://ajax.googleapis.com/ajax/libs/handlebars/4.7.7/handlebars.min.js"></script>
<script>
      'use strict';

      /**
       * Defines an instance of the Locator+ solution, to be instantiated
       * when the Maps library is loaded.
       */
      function LocatorPlus(configuration) {
        const locator = this;

        locator.locations = configuration.locations || [];
        locator.capabilities = configuration.capabilities || {};

        const mapEl = document.getElementById('gmp-map');
        const panelEl = document.getElementById('locations-panel');
        locator.panelListEl = document.getElementById('locations-panel-list');
        const sectionNameEl =
            document.getElementById('location-results-section-name');
        const resultsContainerEl = document.getElementById('location-results-list');

        const itemsTemplate = Handlebars.compile(
            document.getElementById('locator-result-items-tmpl').innerHTML);

        locator.searchLocation = null;
        locator.searchLocationMarker = null;
        locator.selectedLocationIdx = null;
        locator.userCountry = null;

        // Initialize the map -------------------------------------------------------
        locator.map = new google.maps.Map(mapEl, configuration.mapOptions);

        // Store selection.
        const selectResultItem = function(locationIdx, panToMarker, scrollToResult) {
          locator.selectedLocationIdx = locationIdx;
          for (let locationElem of resultsContainerEl.children) {
            locationElem.classList.remove('selected');
            if (getResultIndex(locationElem) === locator.selectedLocationIdx) {
              locationElem.classList.add('selected');
              if (scrollToResult) {
                panelEl.scrollTop = locationElem.offsetTop;
              }
            }
          }
          if (panToMarker && (locationIdx != null)) {
            locator.map.panTo(locator.locations[locationIdx].coords);
          }
        };

        // Create a marker for each location.
        const markers = locator.locations.map(function(location, index) {
          const marker = new google.maps.Marker({
            position: location.coords,
            map: locator.map,
            title: location.title,
          });
          marker.addListener('click', function() {
            selectResultItem(index, false, true);
          });
          return marker;
        });

        // Fit map to marker bounds.
        locator.updateBounds = function() {
          const bounds = new google.maps.LatLngBounds();
          if (locator.searchLocationMarker) {
            bounds.extend(locator.searchLocationMarker.getPosition());
          }
          for (let i = 0; i < markers.length; i++) {
            bounds.extend(markers[i].getPosition());
          }
          locator.map.fitBounds(bounds);
        };
        if (locator.locations.length) {
          locator.updateBounds();
        }

        // Get the distance of a store location to the user's location,
        // used in sorting the list.
        const getLocationDistance = function(location) {
          if (!locator.searchLocation) return null;

          // Use travel distance if available (from Distance Matrix).
          if (location.travelDistanceValue != null) {
            return location.travelDistanceValue;
          }

          // Fall back to straight-line distance.
          return google.maps.geometry.spherical.computeDistanceBetween(
              new google.maps.LatLng(location.coords),
              locator.searchLocation.location);
        };

        // Render the results list --------------------------------------------------
        const getResultIndex = function(elem) {
          return parseInt(elem.getAttribute('data-location-index'));
        };

        locator.renderResultsList = function() {
          let locations = locator.locations.slice();
          for (let i = 0; i < locations.length; i++) {
            locations[i].index = i;
          }
          if (locator.searchLocation) {
            sectionNameEl.textContent =
                'Nearest locations (' + locations.length + ')';
            locations.sort(function(a, b) {
              return getLocationDistance(a) - getLocationDistance(b);
            });
          } else {
            sectionNameEl.textContent = `All locations (${locations.length})`;
          }
          const resultItemContext = { locations: locations };
          resultsContainerEl.innerHTML = itemsTemplate(resultItemContext);
          for (let item of resultsContainerEl.children) {
            const resultIndex = getResultIndex(item);
            if (resultIndex === locator.selectedLocationIdx) {
              item.classList.add('selected');
            }

            const resultSelectionHandler = function() {
              selectResultItem(resultIndex, true, false);
            };

            // Clicking anywhere on the item selects this location.
            // Additionally, create a button element to make this behavior
            // accessible under tab navigation.
            item.addEventListener('click', resultSelectionHandler);
            item.querySelector('.select-location')
                .addEventListener('click', function(e) {
                  resultSelectionHandler();
                  e.stopPropagation();
                });
          }
        };

        // Optional capability initialization --------------------------------------
        initializeSearchInput(locator);
        initializeDistanceMatrix(locator);

        // Initial render of results -----------------------------------------------
        locator.renderResultsList();
      }

      /** When the search input capability is enabled, initialize it. */
      function initializeSearchInput(locator) {
        const geocodeCache = new Map();
        const geocoder = new google.maps.Geocoder();

        const searchInputEl = document.getElementById('location-search-input');
        const searchButtonEl = document.getElementById('location-search-button');

        const updateSearchLocation = function(address, location) {
          if (locator.searchLocationMarker) {
            locator.searchLocationMarker.setMap(null);
          }
          if (!location) {
            locator.searchLocation = null;
            return;
          }
          locator.searchLocation = {'address': address, 'location': location};
          locator.searchLocationMarker = new google.maps.Marker({
            position: location,
            map: locator.map,
            title: 'My location',
            icon: {
              path: google.maps.SymbolPath.CIRCLE,
              scale: 12,
              fillColor: '#3367D6',
              fillOpacity: 0.5,
              strokeOpacity: 0,
            }
          });

          // Update the locator's idea of the user's country, used for units. Use
          // `formatted_address` instead of the more structured `address_components`
          // to avoid an additional billed call.
          const addressParts = address.split(' ');
          locator.userCountry = addressParts[addressParts.length - 1];

          // Update map bounds to include the new location marker.
          locator.updateBounds();

          // Update the result list so we can sort it by proximity.
          locator.renderResultsList();

          locator.updateTravelTimes();
        };

        const geocodeSearch = function(query) {
          if (!query) {
            return;
          }

          const handleResult = function(geocodeResult) {
            searchInputEl.value = geocodeResult.formatted_address;
            updateSearchLocation(
                geocodeResult.formatted_address, geocodeResult.geometry.location);
          };

          if (geocodeCache.has(query)) {
            handleResult(geocodeCache.get(query));
            return;
          }
          const request = {address: query, bounds: locator.map.getBounds()};
          geocoder.geocode(request, function(results, status) {
            if (status === 'OK') {
              if (results.length > 0) {
                const result = results[0];
                geocodeCache.set(query, result);
                handleResult(result);
              }
            }
          });
        };

        // Set up geocoding on the search input.
        searchButtonEl.addEventListener('click', function() {
          geocodeSearch(searchInputEl.value.trim());
        });

        // Initialize Autocomplete.
        initializeSearchInputAutocomplete(
            locator, searchInputEl, geocodeSearch, updateSearchLocation);
      }

      /** Add Autocomplete to the search input. */
      function initializeSearchInputAutocomplete(
          locator, searchInputEl, fallbackSearch, searchLocationUpdater) {
        // Set up Autocomplete on the search input. Bias results to map viewport.
        const autocomplete = new google.maps.places.Autocomplete(searchInputEl, {
          types: ['geocode'],
          fields: ['place_id', 'formatted_address', 'geometry.location']
        });
        autocomplete.bindTo('bounds', locator.map);
        autocomplete.addListener('place_changed', function() {
          const placeResult = autocomplete.getPlace();
          if (!placeResult.geometry) {
            // Hitting 'Enter' without selecting a suggestion will result in a
            // placeResult with only the text input value as the 'name' field.
            fallbackSearch(placeResult.name);
            return;
          }
          searchLocationUpdater(
              placeResult.formatted_address, placeResult.geometry.location);
        });
      }

      /** Initialize Distance Matrix for the locator. */
      function initializeDistanceMatrix(locator) {
        const distanceMatrixService = new google.maps.DistanceMatrixService();

        // Annotate travel times to the selected location using Distance Matrix.
        locator.updateTravelTimes = function() {
          if (!locator.searchLocation) return;

          const units = (locator.userCountry === 'USA') ?
              google.maps.UnitSystem.IMPERIAL :
              google.maps.UnitSystem.METRIC;
          const request = {
            origins: [locator.searchLocation.location],
            destinations: locator.locations.map(function(x) {
              return x.coords;
            }),
            travelMode: google.maps.TravelMode.DRIVING,
            unitSystem: units,
          };
          const callback = function(response, status) {
            if (status === 'OK') {
              const distances = response.rows[0].elements;
              for (let i = 0; i < distances.length; i++) {
                const distResult = distances[i];
                let travelDistanceText, travelDistanceValue;
                if (distResult.status === 'OK') {
                  travelDistanceText = distResult.distance.text;
                  travelDistanceValue = distResult.distance.value;
                }
                const location = locator.locations[i];
                location.travelDistanceText = travelDistanceText;
                location.travelDistanceValue = travelDistanceValue;
              }

              // Re-render the results list, in case the ordering has changed.
              locator.renderResultsList();
            }
          };
          distanceMatrixService.getDistanceMatrix(request, callback);
        };
      }
</script>
<script>
      const CONFIGURATION = {
        "locations": [
          {"title":"926 E McDowell Rd ste 123","address1":"926 E McDowell Rd ste 123","address2":"Phoenix, AZ 85006, USA","coords":{"lat":33.46650353415899,"lng":-112.06151103558197},"placeId":"EjE5MjYgRSBNY0Rvd2VsbCBSZCBzdGUgMTIzLCBQaG9lbml4LCBBWiA4NTAwNiwgVVNBIiMaIQoWChQKEgmrGJzBEhIrhxHmTCRsRg1T1RIHc3RlIDEyMw"},
          {"title":"4350 N 19th Ave ste 5","address1":"4350 N 19th Ave ste 5","address2":"Phoenix, AZ 85015, USA","coords":{"lat":33.50026480733271,"lng":-112.10018590859833},"placeId":"Ei00MzUwIE4gMTl0aCBBdmUgc3RlIDUsIFBob2VuaXgsIEFaIDg1MDE1LCBVU0EiIRofChYKFAoSCXd2rSAfEyuHEWoikILFhAhzEgVzdGUgNQ"},
          {"title":"2001 W Camelback Rd ste 150","address1":"2001 W Camelback Rd ste 150","address2":"Phoenix, AZ 85015, USA","coords":{"lat":33.509234345866496,"lng":-112.10267240674591},"placeId":"EjMyMDAxIFcgQ2FtZWxiYWNrIFJkIHN0ZSAxNTAsIFBob2VuaXgsIEFaIDg1MDE1LCBVU0EiIxohChYKFAoSCV_kxT8kEyuHEXObA19s_yLLEgdzdGUgMTUw"},
          {"title":"2640 W Baseline Rd","address1":"2640 W Baseline Rd","address2":"Phoenix, AZ 85041, USA","coords":{"lat":33.378373990261316,"lng":-112.11568806441804},"placeId":"ChIJ8yDXc-kQK4cREeiRV__uuAo"},
          {"title":"5111 N Scottsdale Rd ste 160","address1":"5111 N Scottsdale Rd ste 160","address2":"Scottsdale, AZ 85250, USA","coords":{"lat":33.51184706593145,"lng":-111.92547266441804},"placeId":"Ejc1MTExIE4gU2NvdHRzZGFsZSBSZCBzdGUgMTYwLCBTY290dHNkYWxlLCBBWiA4NTI1MCwgVVNBIiMaIQoWChQKEgm74un4oAsrhxE-aiCn3RfPthIHc3RlIDE2MA"},
          {"title":"9321 W Thomas Rd ste 105","address1":"9321 W Thomas Rd ste 105","address2":"Phoenix, AZ 85037, USA","coords":{"lat":33.47831769425174,"lng":-112.26180566441803},"placeId":"EjA5MzIxIFcgVGhvbWFzIFJkIHN0ZSAxMDUsIFBob2VuaXgsIEFaIDg1MDM3LCBVU0EiIxohChYKFAoSCdfM5qXsPyuHEQI1K80UH__rEgdzdGUgMTA1"},
          {"title":"15810 S 45th St ste 101","address1":"15810 S 45th St ste 101","address2":"Phoenix, AZ 85048, USA","coords":{"lat":33.30375444763831,"lng":-111.98732166441803},"placeId":"Ei8xNTgxMCBTIDQ1dGggU3Qgc3RlIDEwMSwgUGhvZW5peCwgQVogODUwNDgsIFVTQSIjGiEKFgoUChIJR8D6Z28EK4cR--gjpLavoZwSB3N0ZSAxMDE"},
          {"title":"10450 E Riggs Rd ste 109","address1":"10450 E Riggs Rd ste 109","address2":"Chandler, AZ 85248, USA","coords":{"lat":33.21939085820057,"lng":-111.85662297790985},"placeId":"EjExMDQ1MCBFIFJpZ2dzIFJkIHN0ZSAxMDksIENoYW5kbGVyLCBBWiA4NTI0OCwgVVNBIiMaIQoWChQKEgmRAzjZV1UqhxE-zI-2jLAG6BIHc3RlIDEwOQ"},
          {"title":"3624 W Anthem Way ste c114","address1":"3624 W Anthem Way ste c114","address2":"Anthem, AZ 85086, USA","coords":{"lat":33.86744828430751,"lng":-112.13621817790985},"placeId":"EjEzNjI0IFcgQW50aGVtIFdheSBzdGUgYzExNCwgQW50aGVtLCBBWiA4NTA4NiwgVVNBIiQaIgoWChQKEgkFG0ZF-50shxEsvTyZhhO9wBIIc3RlIGMxMTQ"},
          {"title":"28455 N Vistancia Blvd","address1":"28455 N Vistancia Blvd","address2":"Peoria, AZ 85383, USA","coords":{"lat":33.74000739028031,"lng":-112.32161840674591},"placeId":"Ei0yODQ1NSBOIFZpc3RhbmNpYSBCbHZkLCBQZW9yaWEsIEFaIDg1MzgzLCBVU0EiUhJQCjQKMgk_oMbVp14rhxGWncWoIc5uaBoeCxDuwe6hARoUChIJX2z_zyVfK4cRJgpA_FL9hr8MEKfeASoUChIJiV1mjRZcK4cR3U8gkW0pU7g"}
        ],
        "mapOptions": {
          "mapId": "7814438d65024927",
          "center":{"lat":38.0,"lng":-100.0},
          "fullscreenControl":true,
          "mapTypeControl":false,
          "streetViewControl":false,
          "zoom":4,
          "zoomControl":true,
          "maxZoom":17
        },
        "mapsApiKey": "AIzaSyCjnIuOhhdZ9kn5BQSBZBc2W56OR-Qwby8",
        "capabilities": {
          "input":true,
          "autocomplete":true,
          "directions":false,
          "distanceMatrix":true,
          "details":false
        }
      };

      function initMap() {
        new LocatorPlus(CONFIGURATION);
      }
</script>
<script id="locator-result-items-tmpl" type="text/x-handlebars-template">
      {{#each locations}}
        <li class="location-result" data-location-index="{{index}}">
          <button class="select-location">
            <h2 class="name">{{title}}</h2>
          </button>
          <div class="address">{{address1}}<br>{{address2}}</div>
          {{#if travelDistanceText}}
            <div class="distance">{{travelDistanceText}}</div>
          {{/if}}
        </li>
      {{/each}}
</script>
{% endif %}